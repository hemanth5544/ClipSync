# Railway Configuration for ClipSync Auth Service
# This is the standalone authentication service used by desktop and mobile apps
#
# REQUIRED Environment Variables (set in Railway Dashboard → Variables):
# 1. DATABASE_URL - PostgreSQL connection string
#    - Go to your PostgreSQL service → Variables → Copy DATABASE_URL
#    - Or manually set: postgresql://user:pass@host:port/dbname
# 2. BETTER_AUTH_SECRET - Secret key for Better-Auth (generate a random string)
# 3. JWT_SECRET - Secret key for JWT tokens (generate a random string)
# 4. BETTER_AUTH_BASE_URL - Public URL of this auth service
#    - Example: https://clipsync-auth.up.railway.app
# 5. ALLOWED_ORIGINS - Comma-separated list of allowed CORS origins
#    - Example: http://localhost:3000,https://clipsync.up.railway.app
#
# Optional (for OAuth):
# - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET
# - GITHUB_CLIENT_ID, GITHUB_CLIENT_SECRET
#
# In Railway Dashboard:
# 1. Settings → Source → Root Directory: Set to "apps/auth"
# 2. Settings → Build → Builder: Use "Nixpacks" or "Railpack" (Default)
# 3. Settings → Build → Build Command: Auto-detected from railway.toml
# 4. Settings → Deploy → Start Command: Auto-detected from railway.toml

[build]
builder = "NIXPACKS"
# Force Railway to use pnpm instead of npm
installCommand = "corepack enable && corepack prepare pnpm@8.15.0 --activate && pnpm install"
# When Root Directory is apps/auth, we start from that directory
# Go up to repo root to install workspace deps, then build in apps/auth
buildCommand = "cd ../.. && pnpm install && cd apps/auth && pnpm prisma:generate && (pnpm prisma:db:push || echo 'Migration skipped/failed') && pnpm build"

[deploy]
# Start the production Next.js server
# We're already in apps/auth directory when Root Directory is set to apps/auth
startCommand = "pnpm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
